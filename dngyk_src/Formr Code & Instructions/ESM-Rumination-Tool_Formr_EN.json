{
    "name": "ESM-Rum-EN",
    "units": [
        {
            "type": "Survey",
            "description": "Enrolling survey",
            "position": 1,
            "special": "",
            "survey_data": {
                "name": "enrolling_surveyEN",
                "items": [
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "Intro",
                        "label": "Welcome,\n \nThank you for taking the time to participate in the briefing session and for agreeing to participate in this research. \nYour involvment makes this study possible and it is thanks to you and the other participants that we will be able to contribute to psychological science.\n\n#### Basic information\nFirst, please enter your phone number and email address.\nThis information is necessary to automatically send you the questionnaires and any reminders.",
                        "label_parsed": "<p>Welcome,<\/p>\n<p>Thank you for taking the time to participate in the briefing session and for agreeing to participate in this research.<br \/>\nYour involvment makes this study possible and it is thanks to you and the other participants that we will be able to contribute to psychological science.<\/p>\n<h4>Basic information<\/h4>\n<p>First, please enter your phone number and email address.<br \/>\nThis information is necessary to automatically send you the questionnaires and any reminders.<\/p>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 1
                    },
                    {
                        "type": "email",
                        "choice_list": null,
                        "type_options": null,
                        "name": "email",
                        "label": "Please enter your email address.",
                        "label_parsed": "Please enter your email address.",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 2
                    },
                    {
                        "type": "email",
                        "choice_list": null,
                        "type_options": null,
                        "name": "email2",
                        "label": "Please enter your email address again.",
                        "label_parsed": "Please enter your email address again.",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 3
                    },
                    {
                        "type": "block",
                        "choice_list": null,
                        "type_options": null,
                        "name": "match_error",
                        "label": "Error : please verify your email address.",
                        "label_parsed": "Error : please verify your email address.",
                        "optional": 0,
                        "class": "",
                        "showif": "(email2 != \"\" && email != \"\" && email != email2) \/\/js_only",
                        "value": "",
                        "block_order": null,
                        "item_order": 4
                    },
                    {
                        "type": "tel",
                        "choice_list": null,
                        "type_options": null,
                        "name": "telephone",
                        "label": "Phone number\n <span style=\"color:red\">Format to be used : **0032411223344**<\/span>",
                        "label_parsed": "<p>Phone number<br \/>\n<span style=\"color:red\">Format to be used : <strong>0032411223344<\/strong><\/span><\/p>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 5
                    },
                    {
                        "type": "block",
                        "choice_list": null,
                        "type_options": null,
                        "name": "erreur_tel",
                        "label": "Error : your phone number has the wrong format.",
                        "label_parsed": "Error : your phone number has the wrong format.",
                        "optional": 0,
                        "class": "",
                        "showif": "(telephone != \"\" && (telephone.toString().length < 11 || telephone.toString().length > 11)) \/\/js_only",
                        "value": "",
                        "block_order": null,
                        "item_order": 6
                    },
                    {
                        "type": "tel",
                        "choice_list": null,
                        "type_options": "13,13, 13",
                        "name": "tel2",
                        "label": "Please rewrite your mobile phone number.",
                        "label_parsed": "Please rewrite your mobile phone number.",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 7
                    },
                    {
                        "type": "block",
                        "choice_list": null,
                        "type_options": null,
                        "name": "match_error2",
                        "label": "Error: check your phone number.",
                        "label_parsed": "Error: check your phone number.",
                        "optional": 0,
                        "class": "",
                        "showif": "telephone != tel2 \/\/js_only",
                        "value": "",
                        "block_order": null,
                        "item_order": 8
                    },
                    {
                        "type": "submit",
                        "choice_list": null,
                        "type_options": null,
                        "name": "submit1",
                        "label": "Go to the next step",
                        "label_parsed": "Go to the next step",
                        "optional": 0,
                        "class": "",
                        "showif": "telephone == tel2 \/\/js_only",
                        "value": "",
                        "block_order": null,
                        "item_order": 9
                    },
                    {
                        "type": "random",
                        "choice_list": null,
                        "type_options": "1111,9999",
                        "name": "verification_code_sms",
                        "label": "",
                        "label_parsed": "",
                        "optional": 0,
                        "class": "hidden",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 10
                    },
                    {
                        "type": "random",
                        "choice_list": null,
                        "type_options": "1111,9999",
                        "name": "verification_code_mail",
                        "label": "",
                        "label_parsed": "",
                        "optional": 0,
                        "class": "hidden",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 11
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "text",
                        "label": "Please verify your email and phone number below before we send you verification codes.",
                        "label_parsed": "Please verify your email and phone number below before we send you verification codes.",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 12
                    },
                    {
                        "type": "email",
                        "choice_list": null,
                        "type_options": null,
                        "name": "email_verif",
                        "label": "",
                        "label_parsed": "",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "email",
                        "block_order": null,
                        "item_order": 13
                    },
                    {
                        "type": "tel",
                        "choice_list": null,
                        "type_options": null,
                        "name": "gsm_verif",
                        "label": "",
                        "label_parsed": "",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "telephone",
                        "block_order": null,
                        "item_order": 14
                    },
                    {
                        "type": "submit",
                        "choice_list": null,
                        "type_options": null,
                        "name": "submit",
                        "label": "Go to the next step",
                        "label_parsed": "Go to the next step",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 15
                    }
                ],
                "settings": {
                    "maximum_number_displayed": 5,
                    "displayed_percentage_maximum": 50,
                    "add_percentage_points": 0,
                    "enable_instant_validation": 1,
                    "expire_after": 0,
                    "google_file_id": "1cKBDAHIAT-updWwT8fW6VJ6W61RUx4eMUGb0zCwh1Qs",
                    "unlinked": 0,
                    "expire_invitation_after": 0,
                    "expire_invitation_grace": 0,
                    "hide_results": 0,
                    "use_paging": 1
                }
            }
        },
        {
            "type": "External",
            "description": "send out text-message to verify phone number",
            "position": 2,
            "special": "",
            "external_link": "library(httr)\r\n#------- study checklist\r\n# - check duration of days\r\n# - check number of studies\r\n# - check expiring time of the main survey\r\n\r\n# ===================================\r\n# ========== text-message SETTINGS ===========\r\n# ===================================\r\n\r\nnameRunProject = \"ESM-Rum-EN\"\r\n\r\n# parameters of text-message gateway\r\nbase        = \"https:\/\/WEBSITE ADRESS HERE\"\r\nrequestUri  = \"REQUEsT URI HERE\"\r\napiKey      = \"API KEY HERE\"\r\ndevice_number = 3\r\n\r\n# ===================================\r\n# ===================================\r\n\r\ntelephone = enrolling_surveyEN$gsm_verif # retrieve the stored phone number, you would use something like survey$mobile_number\r\nsession = survey_run_sessions$session\r\nverif_code = enrolling_surveyEN$verification_code_sms\r\n\r\nbody_message = paste0(\"Here is your verification code for the study\\n\\n\", verif_code,\"\\n\\nHere is a link to return to the questionnaire if necessary : https:\/\/\", nameRunProject,\".formr.org\/?code=\", session, \"\\n\")\r\n\r\n\r\nresult <- POST(\r\n  url = base,\r\n  path = requestUri,\r\n  body = list(\r\n    key = apiKey,\r\n    number = telephone,\r\n    message = body_message,\r\n    devices = device_number\r\n  ),\r\n  encode = \"form\",\r\n  verbose(),\r\n  config = httr::config(connecttimeout = 120)\r\n)\r\n(result2 = content(result))\r\n\r\nif(is.null(result2$error_code)) { FALSE } else { TRUE }",
            "api_end": 0,
            "expire_after": 0
        },
        {
            "type": "Email",
            "description": "Send email to verify email address",
            "position": 3,
            "special": "",
            "account_id": 745,
            "subject": "Confirm your email address for the study",
            "recipient_field": "enrolling_surveyEN$email_verif",
            "body": "Your verification code is :\r\n`r enrolling_surveyEN$verification_code_mail`\r\n\r\nIf you need to go back to the questionnaire, here is a link :\r\n{{login_link}}"
        },
        {
            "type": "Survey",
            "description": "survey_confirmation_mail & gsm",
            "position": 4,
            "special": "",
            "survey_data": {
                "name": "confirmation_mail_smsEN",
                "items": [
                    {
                        "type": "hidden",
                        "choice_list": null,
                        "type_options": null,
                        "name": "verification_code_sms",
                        "label": "",
                        "label_parsed": "",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "enrolling_surveyEN$verification_code_sms",
                        "block_order": null,
                        "item_order": 1
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "note",
                        "label": "Please confirm your mobile number by entering the code found in the text message received.",
                        "label_parsed": "Please confirm your mobile number by entering the code found in the text message received.",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 2
                    },
                    {
                        "type": "text",
                        "choice_list": null,
                        "type_options": null,
                        "name": "verification_code_match_sms",
                        "label": "#### Enter the code received here",
                        "label_parsed": "<h4>Enter the code received here<\/h4>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 3
                    },
                    {
                        "type": "block",
                        "choice_list": null,
                        "type_options": null,
                        "name": "match_error",
                        "label": "The code you entered is not the correct code.",
                        "label_parsed": "The code you entered is not the correct code.",
                        "optional": 0,
                        "class": "",
                        "showif": "verification_code_match_sms !=\"\" && verification_code_match_sms != verification_code_sms \/\/js_only",
                        "value": "",
                        "block_order": null,
                        "item_order": 4
                    },
                    {
                        "type": "hidden",
                        "choice_list": null,
                        "type_options": null,
                        "name": "verification_code",
                        "label": "",
                        "label_parsed": "",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "enrolling_surveyEN$verification_code_mail",
                        "block_order": null,
                        "item_order": 5
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "note2",
                        "label": "Please confirm your email address by entering the code found in the email you received.",
                        "label_parsed": "Please confirm your email address by entering the code found in the email you received.",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 6
                    },
                    {
                        "type": "text",
                        "choice_list": null,
                        "type_options": null,
                        "name": "verification_code_match",
                        "label": "#### Enter the code received here",
                        "label_parsed": "<h4>Enter the code received here<\/h4>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 7
                    },
                    {
                        "type": "block",
                        "choice_list": null,
                        "type_options": null,
                        "name": "match_error_2",
                        "label": "The code you entered is not the right code.",
                        "label_parsed": "The code you entered is not the right code.",
                        "optional": 0,
                        "class": "",
                        "showif": "verification_code_match != \"\" && verification_code_match != verification_code \/\/js_only",
                        "value": "",
                        "block_order": null,
                        "item_order": 8
                    },
                    {
                        "type": "submit",
                        "choice_list": null,
                        "type_options": null,
                        "name": "mail_confirmation",
                        "label": "I confirm my email and my mobile phone number",
                        "label_parsed": "I confirm my email and my mobile phone number",
                        "optional": 0,
                        "class": "",
                        "showif": "verification_code_match == verification_code && verification_code_match_sms == verification_code_sms",
                        "value": "",
                        "block_order": null,
                        "item_order": 9
                    }
                ],
                "settings": {
                    "maximum_number_displayed": 0,
                    "displayed_percentage_maximum": 100,
                    "add_percentage_points": 0,
                    "enable_instant_validation": 0,
                    "expire_after": 0,
                    "google_file_id": "1kEo37F4Xk3UYkx8di6AKHvfLXC82mi66Fh4BAS0h6ZM",
                    "unlinked": 0,
                    "expire_invitation_after": 0,
                    "expire_invitation_grace": 0,
                    "hide_results": 0,
                    "use_paging": 0
                }
            }
        },
        {
            "type": "SkipForward",
            "description": "If the person hasn't confirmed in time (90 minutes), skip to end so they can logout and redo it if they want to",
            "position": 5,
            "special": "",
            "condition": "library(lubridate)\r\ntime_passed(minutes = 90)",
            "if_true": 310
        },
        {
            "type": "Survey",
            "description": "Demographics survey",
            "position": 10,
            "special": "",
            "survey_data": {
                "name": "demographicsEN",
                "items": [
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "Intro",
                        "label": "Thank you for confirming your email and phone number.\nPlease fill in the following information.",
                        "label_parsed": "<p>Thank you for confirming your email and phone number.<br \/>\nPlease fill in the following information.<\/p>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 1
                    },
                    {
                        "type": "mc",
                        "choice_list": "sex",
                        "type_options": null,
                        "name": "sex",
                        "label": "Your gender",
                        "label_parsed": "Your gender",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 2,
                        "choices": {
                            "1": "man",
                            "2": "woman",
                            "3": "non-binary"
                        }
                    },
                    {
                        "type": "year",
                        "choice_list": null,
                        "type_options": null,
                        "name": "birthyear",
                        "label": "Birth year",
                        "label_parsed": "Birth year",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 3
                    },
                    {
                        "type": "text",
                        "choice_list": null,
                        "type_options": 8,
                        "name": "code_anonyme",
                        "label": "In order to guarantee your anonymity, your answers will be associated with a code corresponding to the initials of your mother's first name and your father's first name followed by your date of birth in 6 numbers.    \n\nE.g.: Marie's mother is called Nathalie, her father is called Thibault. Marie was born on June 16, 1986, the code will be NT160686 .    \n\nEnter the initials of your mother's first name and your father's first name followed by your date of birth in 6 digits (jour\/mois\/annee), all attached and without spaces as in the example.",
                        "label_parsed": "<p>In order to guarantee your anonymity, your answers will be associated with a code corresponding to the initials of your mother's first name and your father's first name followed by your date of birth in 6 numbers.    <\/p>\n<p>E.g.: Marie's mother is called Nathalie, her father is called Thibault. Marie was born on June 16, 1986, the code will be NT160686 .    <\/p>\n<p>Enter the initials of your mother's first name and your father's first name followed by your date of birth in 6 digits (day\/month\/year), all attached and without spaces as in the example.<\/p>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 4
                    },
                    {
                        "type": "select_or_add_one",
                        "choice_list": "mother_tongue",
                        "type_options": null,
                        "name": "mother_tongue",
                        "label": "What is your native language?\nThe one you use most often.",
                        "label_parsed": "<p>What is your native language?<br \/>\nThe one you use most often.<\/p>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 5,
                        "choices": {
                            "1": "French",
                            "2": "Dutch",
                            "3": "German",
                            "4": "Italian",
                            "5": "Spanish",
                            "6": "Russian",
                            "7": "Polish",
                            "8": "Portuguese",
                            "9": "English",
                            "10": "Ukranian",
                            "11": "Romanian",
                            "12": "Chinese"
                        }
                    },
                    {
                        "type": "select_or_add_multiple",
                        "choice_list": "other_languages",
                        "type_options": null,
                        "name": "other_languages",
                        "label": "What other languages are you fluent in?",
                        "label_parsed": "What other languages are you fluent in?",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 6,
                        "choices": {
                            "1": "French",
                            "2": "Dutch",
                            "3": "German",
                            "4": "Italian",
                            "5": "Spanish",
                            "6": "Russian",
                            "7": "Polish",
                            "8": "Portuguese",
                            "9": "English",
                            "10": "Ukranian",
                            "11": "Romanian",
                            "12": "Chinese"
                        }
                    },
                    {
                        "type": "number",
                        "choice_list": null,
                        "type_options": "0,32,1",
                        "name": "years_of_studies",
                        "label": "How many years of formal education have you completed?\nIndicate the number of studies by counting from high school.\nExample: 6 years of high school + 3 years of bachelor\/high school + 1 year of master = 10",
                        "label_parsed": "<p>How many years of formal education have you completed?<br \/>\nIndicate the number of studies by counting from high school.<br \/>\nExample: 6 years of high school + 3 years of bachelor\/high school + 1 year of master = 10<\/p>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 7
                    },
                    {
                        "type": "mc",
                        "choice_list": "occupation",
                        "type_options": null,
                        "name": "occupation",
                        "label": "What is your main occupation?",
                        "label_parsed": "What is your main occupation?",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 8,
                        "choices": {
                            "1": "Employee",
                            "2": "Self-employed",
                            "3": "Student",
                            "4": "Unemployed",
                            "5": "PhD student",
                            "6": "Other"
                        }
                    },
                    {
                        "type": "select_or_add_one",
                        "choice_list": "country_living",
                        "type_options": null,
                        "name": "country_living",
                        "label": "In which country do you currently live?",
                        "label_parsed": "In which country do you currently live?",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 9,
                        "choices": {
                            "1": "Belgium",
                            "2": "France",
                            "3": "Netherlands",
                            "4": "Germany",
                            "5": "Spain",
                            "6": "Italy",
                            "7": "England",
                            "8": "Switzerland",
                            "9": "Poland"
                        }
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "reread",
                        "label": "**Make sure you have answered everything before submitting.**",
                        "label_parsed": "<strong>Make sure you have answered everything before submitting.<\/strong>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 10
                    },
                    {
                        "type": "submit",
                        "choice_list": null,
                        "type_options": null,
                        "name": "submit2",
                        "label": "Submit",
                        "label_parsed": "Submit",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 11
                    }
                ],
                "settings": {
                    "maximum_number_displayed": 0,
                    "displayed_percentage_maximum": 100,
                    "add_percentage_points": 0,
                    "enable_instant_validation": 1,
                    "expire_after": 0,
                    "google_file_id": "13NpL6acvkrKm1o6_pbS97TmpmN2DBayl5urxP8nWi8U",
                    "unlinked": 0,
                    "expire_invitation_after": 0,
                    "expire_invitation_grace": 0,
                    "hide_results": 0,
                    "use_paging": 1
                }
            }
        },
        {
            "type": "SkipForward",
            "description": "If enough rows have passed, then skip to end",
            "position": 195,
            "special": "",
            "condition": "# repeat till the maximum number of surveys has been achieved\r\nlibrary(dplyr)\r\nlibrary(lubridate)\r\n\r\n# ===================================\r\n# ====== define all variables =======\r\n# ===================================\r\n\r\ndays_duration_study = 14\r\nsurveys_by_day      = 4\r\ntimezone            = \"CET\"\r\nto_day              = today(timezone)\r\nnow_date            = now(timezone)\r\nt_zero              = \"00:05\"\r\nlast_timepoint      = \"23:30\"\r\ntimepoints          = c(\"09:00\", \"13:00\",\"17:00\",\"21:00\")  # write just the hours\r\nESM_questionnaire   = EF_RUM_ESM_v2_EN\r\n\r\n# ===================================\r\n# ===================================\r\n\r\n\r\nmax_surveys = surveys_by_day * days_duration_study\r\n\r\nif(!exists(\"ESM_questionnaire\")){\r\ndays = ESM_questionnaire %>% mutate(day = as.Date(created)) %>% summarize(n_days = n_distinct(day))\r\n\r\ndays$n_days >= days_duration_study } else { FALSE }\r\n",
            "if_true": 300
        },
        {
            "type": "Pause",
            "description": "Pause till start of the study the next day",
            "position": 200,
            "special": "",
            "wait_until_time": "",
            "wait_until_date": "",
            "wait_minutes": "",
            "relative_to": "library(lubridate)\r\nnext_day()\r\n",
            "body": "```{r, include=FALSE, echo=FALSE, warning=FALSE, message=FALSE}\r\nlibrary(dplyr)\r\nlibrary(lubridate)\r\n# ===================================\r\n# ====== define all variables =======\r\n# ===================================\r\n\r\ndays_duration_study = 14\r\nsurveys_by_day      = 4\r\ntimezone            = \"CET\"\r\nto_day              = today(timezone)\r\nnow_date            = now(timezone)\r\nt_zero              = \"00:05\"\r\nlast_timepoint      = \"23:30\"\r\ntimepoints          = c(\"09:00\", \"13:00\",\"17:00\",\"21:00\")  # write just the hours\r\nESM_questionnaire   = EF_RUM_ESM_v2_EN\r\n\r\n# ===================================\r\n# ===================================\r\n\r\n# ===================================\r\n# ===================================\r\n\r\nmax_surveys = surveys_by_day * days_duration_study\r\ndays_done = 0\r\ntext = \"\"\r\n# ====================================\r\n# == first check whether they enrolled into the study\r\n# ====================================\r\n\r\nif(!exists(\"ESM_questionnaire\") || nrow(ESM_questionnaire) == 0){ text = paste0(\"Your email address and mobile phone number have been confirmed. This allows us to be sure that you will receive reminders by text-message and email to complete the questionnaires. \") } else {\r\n\r\n# ====================================\r\n# == option 2 : they already started the esm period\r\n# ====================================\r\n\r\n\r\n# lets check how many questionnaires they filled\r\nNsurv_filled_today    = ESM_questionnaire %>% select(ended) %>% filter(!is.na(ended)) %>% mutate(ended = as.Date(ended)) %>% filter(ended == to_day) %>%  nrow()\r\n\r\nprint(Nsurv_filled_today)\r\n\r\ndate_start = as.Date(enrolling_surveyEN$created)\r\n\r\nlast_day_study = as.Date(enrolling_surveyEN$created)+ days(days_duration_study)\r\n\r\n# get the numbers of day left\r\ndays_left = last_day_study - today()\r\n# difftime(df$datevar1 ,df$datevar2 , units = c(\"days\"))\r\n\r\ndays_done = days_duration_study - days_left\r\n\r\nif(!is.na(Nsurv_filled_today)){\r\ncompletion_rate = Nsurv_filled_today\/surveys_by_day * 100\r\n} else {\r\n    completion_rate = 0\r\n}\r\nif(completion_rate >= 70) {\r\n    text = paste0(\"Today, you had a response rate of \", completion_rate,\"% ! This is really great, thanks for taking this research seriously.\")\r\n} else if(completion_rate <= 30){\r\n    text = paste0(text, \"We can see that you only answered one questionnaire today. Do not hesitate to contact me (<enter email>) if you have any problems or difficulties with the study\")\r\n} else {\r\n    text = \"\"\r\n}\r\n\r\n# \r\n\r\n}\r\n\r\n# create intermittent reinforcement messages\r\nreinforcement = \"\"\r\nd = days_done + 1\r\nreinforcement <- switch(d,\r\n\"0\" = \"### Thank you for your participation!\",\r\n\"1\" = \"Thank you for your participation ! Please let us know if you encounter any difficulties in completing the questionnaires or participating in this study: <enter email>\",\r\n\"2\" = \"### Thank you for your participation!\",\r\n\"3\" = \"### Thank you for your participation!\",\r\n\"4\" = \"Already 4 days!\r\n\\n\\n\r\nWe want to thank you and encourage you to continue. As simple as it may seem, each answer you provide improves the quality of this study, helps us to better understand our thoughts in our daily lives and, above all, contributes to the advancement of psychological research. Thank you for your involvement throughout these four days.\r\n\\n\\n\r\nPlease do not hesitate to send us your questions or concerns about the questionnaires ( <enter email> ). This study is unique; so is your participation.\",\r\n\"5\" = \"### Thank you for your participation!\",\r\n\"6\" = \"### Thank you for your participation!\",\r\n\"7\" = \"### Thank you for your participation!\",\r\n\"8\" = \"This is remarkable. You have completed more than half of the study! Your experience and involvement in this research directly enhances the quality of this research. Thank you for your commitment !\",\r\n\"9\" = \"### Thank you for your participation!\",\r\n\"10\" = \"### Thank you for your participation!\",\r\n\"11\" = \"Only 3 days left, it's the final stretch! Every answer matters and allows us to make our statistical analysis more reliable.\",\r\n\"12\" = \"### Thank you for your participation!\",\r\n\"13\" = \"The end of the study is near, only one day left!\",\r\n\"14\" = \"### Thank you for your participation!\",)\r\n\r\n# let's create a progress visual\r\n\r\nprogress = \"\"\r\nfor(i in 1:days_duration_study) {\r\n  if(i <= days_done) {\r\n  progress = paste0(progress, \"\\n### <span style='color:green;display:inline-block; width:95px;'>**Day** **\",i,\"**<\/span> ![](https:\/\/i.imgur.com\/nUY7Ifu.png){width=50px}\\n\")\r\n  } else if (i > days_done) {\r\n  progress = paste0(progress, \"\\n### <span style='color:darkgray;display:inline-block;width:95px;'>**Day** **\",i,\"**<\/span> ![](https:\/\/i.imgur.com\/5OY8PC6.png){width=50px}\\n\")\r\n  }\r\n  \r\n}\r\n\r\n```\r\n\r\n***\r\n\r\n`r reinforcement`\r\n<br>\r\n\r\n`r text`\r\n\r\n***\r\n\r\nTomorrow, you will receive an invitation by text-message to complete the questionnaire at `r paste(timepoints, sep=\", \")`.\r\n\r\nYou will have **2 hours maximum** to answer each time. However, try to respond as soon as possible. You will receive 1 reminder by *text-message* one hour after the first notification.\r\n\r\nSee you tomorrow!\r\n\r\n***\r\n\r\n### Your progress :\r\n`r progress`\r\n\r\n***\r\n\r\n\r\n\r\n\r\n\r\n\r\nYou can close this page now.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"
        },
        {
            "type": "SkipForward",
            "description": "Check if it's later than 23:00 or if it's already the last day (just in case)",
            "position": 206,
            "special": "",
            "condition": "library(dplyr)\r\nlibrary(lubridate)\r\n\r\n# ===================================\r\n# ====== define all variables =======\r\n# ===================================\r\n\r\ndays_duration_study = 14\r\nsurveys_by_day      = 4\r\ntimezone            = \"CET\"\r\nto_day              = today(timezone)\r\nnow_date            = now(timezone)\r\nt_zero              = \"00:05\"\r\nlast_timepoint      = \"23:30\"\r\ntimepoints          = c(\"09:00\", \"13:00\",\"17:00\",\"21:00\")  # write just the hours\r\n\r\n# ===================================\r\n# ===================================\r\n\r\n\r\nmax_surveys = surveys_by_day * days_duration_study\r\n\r\n\r\ndate_start = as.Date(enrolling_surveyEN$created)\r\nlast_day_study = as.Date(enrolling_surveyEN$created)+ days(days_duration_study)\r\n\r\ntoday() > last_day_study || now_date > force_tz(today(tz = timezone) + hm(last(timepoints)), tzone = timezone)",
            "if_true": 270
        },
        {
            "type": "Pause",
            "description": "Send 5 questionnaires daily",
            "position": 210,
            "special": "",
            "wait_until_time": "",
            "wait_until_date": "",
            "wait_minutes": 0,
            "relative_to": "library(lubridate)\r\nlibrary(hms)\r\n# ===================================\r\n# ====== define all variables =======\r\n# ===================================\r\n\r\ndays_duration_study = 14\r\nsurveys_by_day      = 4\r\ntimezone            = \"CET\"\r\nto_day              = today(timezone)\r\nnow_date            = now(timezone)\r\nt_zero              = \"00:05\"\r\nlast_timepoint      = \"23:30\"\r\ntimepoints          = c(\"09:00\", \"13:00\",\"17:00\",\"21:00\")  # write just the hours\r\n\r\n# ===================================\r\n# ===================================\r\n\r\n\r\nt1 = force_tz(today(\"CET\") + hm(timepoints[1]), tzone = timezone)\r\nt2 = force_tz(to_day + hm(timepoints[2]), tzone = timezone)\r\nt3 = force_tz(to_day + hm(timepoints[3]), tzone = timezone)\r\nt4 = force_tz(to_day + hm(timepoints[4]), tzone = timezone)\r\n\r\n# calculer quand le questionnaire sera envoyé ensuite\r\ntime = \"\"\r\n\r\nif(now_date < t1) { \r\ntime = t1\r\n} else if(now_date < t2) { \r\ntime = t2\r\n} else if(now_date < t3) { \r\ntime = t3\r\n} else if(now_date < t4) { \r\ntime = t4\r\n}\r\n\r\nas_hms(time)",
            "body": "```{r, include=FALSE, warning = FALSE, message=FALSE, echo=TRUE}\r\nlibrary(lubridate)\r\nlibrary(hms)\r\nlibrary(dplyr)\r\n# ===================================\r\n# ====== define all variables =======\r\n# ===================================\r\n\r\ndays_duration_study = 14\r\nsurveys_by_day      = 4\r\ntimezone            = \"CET\"\r\nto_day              = today(timezone)\r\nnow_date            = now(timezone)\r\nt_zero              = \"00:05\"\r\nlast_timepoint      = \"23:30\"\r\ntimepoints          = c(\"09:00\", \"13:00\",\"17:00\",\"21:00\")  # write just the hours\r\nESM_questionnaire   = EF_RUM_ESM_v2_EN\r\n\r\n# ===================================\r\n# ===================================\r\n\r\nto_day = today(timezone)\r\nnow_date = now(timezone)\r\nt_end = force_tz(to_day + hm(last_timepoint), tzone = timezone)\r\n\r\nt = c()\r\n# create as many timepoints as needed\r\nfor(i in 1:length(timepoints)){\r\n  t[i] = as.character(force_tz(to_day + hm(timepoints[i])), tzone = timezone)\r\n}\r\n\r\n# create the interval list\r\nintervals_list = list()\r\nfor(i in 1:length(t)){\r\n  if(i == length(t)){\r\n    intervals_list = c(intervals_list, list(interval(ymd_hms(t[i], tz = timezone),ymd_hms(t_end,  tz = timezone))))\r\n  } else {\r\n    intervals_list = c(intervals_list, list(interval(ymd_hms(t[i], tz = timezone),ymd_hms(t[i+1],  tz = timezone))))\r\n\r\n  }\r\n}\r\n\r\n# ===================================================================\r\n# 1) get the dates of ESM_questionnaire$created with dplyr::pull(aframe, a2)\r\n\r\n\r\nif(nrow(ESM_questionnaire) > 0 ){\r\n  entries_of_today = force_tz(ymd_hms(ESM_questionnaire %>% select(\"ended\") %>% filter(ended == today()) %>% pull(ended)), tzone = timezone) \r\n} else {\r\n  entries_of_today = NULL\r\n}\r\n\r\n\r\n# depending on the time check whether the questionnaires have been skipped or not.\r\nnow()\r\n\r\ne = 0\r\nprogress = \"\"\r\ntext = \"\"\r\n# == T0 == si on il n'est pas encore l'heure, attendre\r\nfor(i in 1:length(t)){\r\n  if(now_date < t[i] ){\r\n    # if here, it means that it hasn't been answered yet\r\n      progress = paste0(progress, \"\\n#### <span style='color:darkgray'>**\",format(strptime(t[i],\"%Y-%m-%d %H:%M:%S\"), \"%H:%M\"),\"**<\/span> ![](https:\/\/i.imgur.com\/xuosH6S.png){width=40px}\\n\")\r\n    \r\n    if( i == e ){\r\n        \r\n        text = paste0(\"#### Thank you very much for your answers. You will receive your next questionnaire at \", format(strptime(t[i],\"%Y-%m-%d %H:%M:%S\"), \"%H:%M\"),\".\\n\\nSee you later.\" )\r\n        print(text) \r\n      } \r\n      \r\n    # if it's the time of the day\r\n      if( i == 1 ){\r\n        text = paste0(\"Hello, it is still too early!\\n\\nYou will receive your next questionnaire at \", format(strptime(t[i],\"%Y-%m-%d %H:%M:%S\"), \"%H:%M\"),\". \\n\\nSee you later.\" )\r\n        print(text)\r\n      } \r\n  } else {\r\n    e = i+1\r\n    \r\n    # so the time point has passed\r\n    # test whether the participant answered the survey\r\n    \r\n    if(!is.null(entries_of_today)){\r\n      if(any(entries_of_today %within% intervals_list[i])) {\r\n        # if TRUE, SHOW GREEN PICTURE\r\n        progress = paste0(progress, \"\\n#### <span style='color:green'>**\", format(strptime(t[i],\"%Y-%m-%d %H:%M:%S\"), \"%H:%M\"),\"**<\/span> ![](https:\/\/i.imgur.com\/nUY7Ifu.png){width=40px}\\n\")\r\n      } else {\r\n        # if FALSE, SHOW RED PICTURE\r\n        progress = paste0(progress, \"\\n#### <span style='color:red'>**\", format(strptime(t[i],\"%Y-%m-%d %H:%M:%S\"), \"%H:%M\"),\"**<\/span> ![](https:\/\/i.imgur.com\/d8RGdld.png){width=40px}\\n\")\r\n      }\r\n    } else {\r\n      # if FALSE, SHOW RED PICTURE\r\n      progress = paste0(progress, \"\\n#### <span style='color:red'>**\", format(strptime(t[i],\"%Y-%m-%d %H:%M:%S\"), \"%H:%M\"),\"**<\/span> ![](https:\/\/i.imgur.com\/d8RGdld.png){width=40px}\\n\")\r\n    }\r\n  }\r\n}\r\n\r\n```\r\n\r\n***\r\n\r\n`r text`\r\n\r\n***\r\n\r\n#### Your progress today\r\n\r\n`r progress`"
        },
        {
            "type": "External",
            "description": "text-message notification",
            "position": 230,
            "special": "",
            "external_link": "library(httr)\r\n\r\n# ===================================\r\n# ========== text-message SETTINGS ===========\r\n# ===================================\r\n\r\nnameRunProject = \"ESM-Rum-EN\"\r\n\r\n# parameters of SMS gateway\r\nbase        = \"https:\/\/WEBSITE URL\"\r\nrequestUri  = \"REQUEST URI\"\r\napiKey      = \"API KEY\"\r\ndevice_number = 3\r\n\r\n# ===================================\r\n# ===================================\r\n\r\ntelephone = enrolling_surveyEN$telephone # retrieve the stored phone number, you would use something like survey$mobile_number\r\nsession = survey_run_sessions$session\r\n\r\nbody_message = paste0(\"Hello,\\nHere is the link to answer the questionnaire: https:\/\/\", nameRunProject,\".formr.org\/?code=\", session, \"\\nAnswer it as soon as possible.\\nThank you very much in advance.\\nYorgo H.\")\r\n\r\n\r\nresult <- POST(\r\n  url = base,\r\n  path = requestUri,\r\n  body = list(\r\n    key = apiKey,\r\n    number = telephone,\r\n    message = body_message,\r\n    devices = device_number\r\n  ),\r\n  encode = \"form\",\r\n  verbose(),\r\n  config = httr::config(connecttimeout = 120)\r\n)\r\n(result2 = content(result))\r\n\r\nif(is.null(result2$error_code)) { FALSE } else { TRUE }",
            "api_end": 0,
            "expire_after": 0
        },
        {
            "type": "Wait",
            "description": "First reminder after 60 minutes if the person has not yet responded",
            "position": 231,
            "special": "",
            "wait_until_time": "",
            "wait_until_date": "",
            "wait_minutes": 59,
            "relative_to": "",
            "body": 245
        },
        {
            "type": "External",
            "description": "text-message reminder",
            "position": 232,
            "special": "",
            "external_link": "library(httr)\r\n\r\n# ===================================\r\n# ========== text-message SETTINGS ===========\r\n# ===================================\r\n\r\nnameRunProject = \"ESM-Rum-EN\"\r\n\r\n# parameters of SMS gateway\r\nbase        = \"https:\/\/WEBSITE URL\"\r\nrequestUri  = \"REQUEST URI\"\r\napiKey      = \"PUT YOUR API KEY HERE\"\r\ndevice_number = 3\r\n\r\n# ===================================\r\n# ===================================\r\n\r\ntelephone = enrolling_surveyEN$telephone # retrieve the stored phone number, you would use something like survey$mobile_number\r\nsession = survey_run_sessions$session\r\n\r\n\r\nbody_message = paste0(\"REMINDER: please do not forget to answer the questionnaire.\\n\\nHere is the link to answer the questionnaire : https:\/\/\", nameRunProject,\".formr.org\/?code=\", session, \"\\nYou have 60 minutes to answer.\\nThank you very much in advance.\\nYorgo H.\")\r\n\r\nresult <- POST(\r\n  url = base,\r\n  path = requestUri,\r\n  body = list(\r\n    key = apiKey,\r\n    number = telephone,\r\n    message = body_message,\r\n    devices = device_number\r\n  ),\r\n  encode = \"form\",\r\n  verbose(),\r\n  config = httr::config(connecttimeout = 120)\r\n)\r\n(result2 = content(result))\r\n\r\nif(is.null(result2$error_code)) { FALSE } else { TRUE }",
            "api_end": 0,
            "expire_after": 0
        },
        {
            "type": "Survey",
            "description": "Daily questionnaire",
            "position": 245,
            "special": "",
            "survey_data": {
                "name": "EF_RUM_ESM_v2_EN",
                "items": [
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "introduction",
                        "label": "```{r, include=FALSE, warning = FALSE, message=FALSE, echo=FALSE}\nlibrary(lubridate)\nlibrary(hms)\n\ndays_duration_study = 14\nsurveys_by_day      = 4\ntimezone            = \"CET\"\nto_day              = today(timezone)\nnow_date            = now(timezone)\nt_zero              = \"00:05\"\nlast_timepoint      = \"23:30\"\ntimepoints          = c(\"09:00\",\"13:00\",\"17:00\",\"21:00\")\nESM_questionnaire   = EF_RUM_ESM_v2_EN\n\nt1 = force_tz(to_day + hm(timepoints[1]), tzone = timezone)\nt2 = force_tz(to_day + hm(timepoints[2]), tzone = timezone)\nt3 = force_tz(to_day + hm(timepoints[3]), tzone = timezone)\nt4 = force_tz(to_day + hm(timepoints[4]), tzone = timezone)\n\ntime = \"\"\n\nif(now_date < t1) { \ntext_consigne = \"Since you woke up...\"\n} else if(now_date < t2) { \ntext_consigne = \"Since you woke up...\"\n} else if(now_date < t3) { \ntext_consigne = paste0(\"Since the previous survey (\", timepoints[1], \")...\")\n} else if(now_date < t4) { \ntext_consigne = paste0(\"Since the previous survey (\", timepoints[2], \")...\")\n} else if(now_date > t4) { \ntext_consigne = paste0(\"Since the previous survey (\", timepoints[3], \")...\")\n} \n\nNday <- nrow(ESM_questionnaire)\n if(Nday == 1){ text <- \"Here is your first daily questionnaire. \\n There is no right or wrong answer. It is your experience and only your experience that interests us. As a reminder, your participation is completely anonymous.\" } else {\n   text = \"\\n \\n\"\n }\n\n\n ```\n\n### Hello`r knitr::asis_output(\"\\U1F44B\")` !\n`r text`\n\n`r knitr::asis_output(\"\\U23F3\")` Take a few moments for yourself to reflect on the hours that have passed and answer these questions.\n\n**`r text_consigne`**",
                        "label_parsed": null,
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 1
                    },
                    {
                        "type": "range",
                        "choice_list": "perseverance",
                        "type_options": "0,100,1",
                        "name": "perseverance",
                        "label": "<div class=\"tooltip\">\nHow much time did you spend thinking of one or more emotional experiences?\n<span class=\"tooltiptext\">This question refers to how much time you spent lost in your thoughts, either thinking about emotions, problems, or something that happened to you, instead of being absorbed by the activity you were doing.<\/span>\n<\/div>",
                        "label_parsed": "<div class=\"tooltip\">\nHow much time did you spend thinking of one or more emotional experiences?\n<span class=\"tooltiptext\">This question refers to how much time you spent lost in your thoughts, either thinking about emotions, problems, or something that happened to you, instead of being absorbed by the activity you were doing.<\/span>\n<\/div>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 3,
                        "choices": {
                            "1": "None",
                            "2": "All the time"
                        }
                    },
                    {
                        "type": "range",
                        "choice_list": "negativity",
                        "type_options": "0,100,1",
                        "name": "negativity",
                        "label": "<div class=\"tooltip\">\nTo what extent were your thoughts negative? \n<span class=\"tooltiptext\">This refers to the content of your thoughts: for example if you’re thinking of a negative situation, negative events, bad memories, unpleasant sensations, discouraging thoughts, thoughts about negative emotions (intense stress, anxiety, anger), ...<\/span>\n<\/div>",
                        "label_parsed": "<div class=\"tooltip\">\nTo what extent were your thoughts negative? \n<span class=\"tooltiptext\">This refers to the content of your thoughts: for example if you’re thinking of a negative situation, negative events, bad memories, unpleasant sensations, discouraging thoughts, thoughts about negative emotions (intense stress, anxiety, anger), ...<\/span>\n<\/div>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 3,
                        "choices": {
                            "1": "Not at all",
                            "2": "Extremely"
                        }
                    },
                    {
                        "type": "range",
                        "choice_list": "criticism",
                        "type_options": "0,100,1",
                        "name": "criticism",
                        "label": "<div class=\"tooltip\">\nTo what extent were your thoughts self-critical?\n<span class=\"tooltiptext\">This question refers to ‘self-critical’ thinking, meaning thoughts you have about yourself when: you’re dissatisfied with what you’re doing or how you’re reacting, you’re unhappy with who you are, or when you have goals in mind but you criticize yourself that you haven’t attained them yet... \nIn contrast, thoughts about yourself that are not ‘self-critical’: these are encouragements, self-compassion, positive thinking (for ex.: “I wasn’t able to do it now but I’ll get there at some point”).<\/span>\n<\/div>",
                        "label_parsed": "<div class=\"tooltip\">\nTo what extent were your thoughts self-critical?\n<span class=\"tooltiptext\">This question refers to ‘self-critical’ thinking, meaning thoughts you have about yourself when: you’re dissatisfied with what you’re doing or how you’re reacting, you’re unhappy with who you are, or when you have goals in mind but you criticize yourself that you haven’t attained them yet... \nIn contrast, thoughts about yourself that are not ‘self-critical’: these are encouragements, self-compassion, positive thinking (for ex.: “I wasn’t able to do it now but I’ll get there at some point”).<\/span>\n<\/div>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 3,
                        "choices": {
                            "1": "Not at all",
                            "2": "Extremely"
                        }
                    },
                    {
                        "type": "range",
                        "choice_list": "brooding",
                        "type_options": "0,100,1",
                        "name": "brooding",
                        "label": "<div class=\"tooltip\">\nHow much did you think about the causes and consequences of emotional experiences? \n<span class=\"tooltiptext\">This refers to if you think of the causes or consequences of one or several emotional experiences (which could be positive or negative) that are either currently ongoing or in the past. A few examples: wondering what caused an argument with your partner; thinking about the consequences of a frustrating phone call; wondering why you have difficulty concentrating; trying to figure out why you feel bad or stressed; thinking about why you messed up a particular task; thinking about the causes and consequences of having failed an exam or a job interview; etc. <\/span>\n<\/div>",
                        "label_parsed": "<div class=\"tooltip\">\nHow much did you think about the causes and consequences of emotional experiences? \n<span class=\"tooltiptext\">This refers to if you think of the causes or consequences of one or several emotional experiences (which could be positive or negative) that are either currently ongoing or in the past. A few examples: wondering what caused an argument with your partner; thinking about the consequences of a frustrating phone call; wondering why you have difficulty concentrating; trying to figure out why you feel bad or stressed; thinking about why you messed up a particular task; thinking about the causes and consequences of having failed an exam or a job interview; etc. <\/span>\n<\/div>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 3,
                        "choices": {
                            "1": "Not at all",
                            "2": "Absolutely"
                        }
                    },
                    {
                        "type": "range",
                        "choice_list": "replaying",
                        "type_options": "0,100,1",
                        "name": "replaying",
                        "label": "<div class=\"tooltip\">\nTo what extend have you mentally replayed emotional experiences that you’ve had? \n<span class=\"tooltiptext\">This refers to whether you relived certain scenes from emotional experiences, or ‘replayed’ an event in your mind (regardless of whether it was a positive or negative experience).<\/span>\n<\/div>",
                        "label_parsed": "<div class=\"tooltip\">\nTo what extend have you mentally replayed emotional experiences that you’ve had? \n<span class=\"tooltiptext\">This refers to whether you relived certain scenes from emotional experiences, or ‘replayed’ an event in your mind (regardless of whether it was a positive or negative experience).<\/span>\n<\/div>",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 3,
                        "choices": {
                            "1": "Not at all",
                            "2": "Absolutely"
                        }
                    },
                    {
                        "type": "submit",
                        "choice_list": null,
                        "type_options": null,
                        "name": "submit",
                        "label": "Submit `r knitr::asis_output(\"\\U2714\")`",
                        "label_parsed": null,
                        "optional": 0,
                        "class": "",
                        "showif": "replaying != 50 && brooding != 50 && criticism != 50 && negativity != 50 && perseverance != 50",
                        "value": "",
                        "block_order": null,
                        "item_order": 4
                    }
                ],
                "settings": {
                    "maximum_number_displayed": 0,
                    "displayed_percentage_maximum": 100,
                    "add_percentage_points": 0,
                    "enable_instant_validation": 1,
                    "expire_after": 0,
                    "google_file_id": "1wLw9075gQSRpvETmRe7ZRGhkrFwb2XOfE30HQrU_Puk",
                    "unlinked": 0,
                    "expire_invitation_after": 60,
                    "expire_invitation_grace": 9,
                    "hide_results": 0,
                    "use_paging": 1
                }
            }
        },
        {
            "type": "SkipBackward",
            "description": "Repeat 5 times a day",
            "position": 260,
            "special": "",
            "condition": "# we need to repeat the survey five times a day, so we check whether the nrow() is a multiple of the number of surveys by day\r\nlibrary(lubridate)\r\n\r\n# ===================================\r\n# ====== define all variables =======\r\n# ===================================\r\n\r\ndays_duration_study = 14\r\nsurveys_by_day      = 4\r\ntimezone            = \"CET\"\r\nto_day              = today(timezone)\r\nnow_date            = now(timezone)\r\nt_zero              = \"00:05\"\r\nlast_timepoint      = \"23:30\"\r\ntimepoints          = c(\"09:00\", \"13:00\",\"17:00\",\"21:00\")  # write just the hours\r\nESM_questionnaire   = EF_RUM_ESM_v2_EN\r\n\r\n# ===================================\r\n# ===================================\r\n\r\n# we check whether the last answer or expired survey was after last timepoint OR if the now() time is after last time point\r\nformat(strptime(last(ESM_questionnaire$ended),\"%Y-%m-%d %H:%M:%S\"), \"%H:%M\") < last(timepoints) || if(exists(\"ESM_questionnaire$expired\")){  format(strptime(last(ESM_questionnaire$expired),\"%Y-%m-%d %H:%M:%S\"), \"%H:%M\") < last(timepoints) } else { FALSE } || format(strptime(now(),\"%Y-%m-%d %H:%M:%S\"), \"%H:%M\") < last(timepoints)\r\n\r\n\r\n",
            "if_true": 206
        },
        {
            "type": "SkipBackward",
            "description": "Repeat till n days of duration study",
            "position": 270,
            "special": "",
            "condition": "# repeat till the maximum number of surveys has been achieved\r\nlibrary(dplyr)\r\nlibrary(lubridate)\r\n\r\n# ===================================\r\n# ====== define all variables =======\r\n# ===================================\r\n\r\ndays_duration_study = 14\r\nsurveys_by_day      = 4\r\ntimezone            = \"CET\"\r\nto_day              = today(timezone)\r\nnow_date            = now(timezone)\r\nt_zero              = \"00:05\"\r\nlast_timepoint      = \"23:30\"\r\ntimepoints          = c(\"09:00\", \"13:00\",\"17:00\",\"21:00\")  # write just the hours\r\n\r\n# ===================================\r\n# ===================================\r\n\r\n\r\nmax_surveys = surveys_by_day * days_duration_study\r\n\r\n# days = EF_RUM_ESM_v2 %>% mutate(day = as.Date(created)) %>% summarize(n_days = n_distinct(day))\r\n\r\n## get date of the beginning of the study\r\n# enrolling questionnaire$created + 1 + n_days\r\n\r\ndate_start = as.Date(enrolling_surveyEN$created)\r\nlast_day_study = as.Date(enrolling_surveyEN$created)+ days(days_duration_study)\r\n\r\ntoday() < last_day_study",
            "if_true": 195
        },
        {
            "type": "Survey",
            "description": "End_questionnaires",
            "position": 290,
            "special": "",
            "survey_data": {
                "name": "End_questionnairesEN",
                "items": [
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "questionnaires",
                        "label": "## End Questionnaires\n\nGreat, you've made it this far. These four questionnaires are the last step before closing this part of the study!\nPlease take your time to complete these. They allow us to know how you were feeling overall during the study.",
                        "label_parsed": "<h2>End Questionnaires<\/h2>\n<p>Great, you've made it this far. These four questionnaires are the last step before closing this part of the study!<br \/>\nPlease take your time to complete these. They allow us to know how you were feeling overall during the study.<\/p>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 1
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "QuestionGAD",
                        "label": "**Questionnaire 1 : Over the last 2 weeks, how often have you been bothered by the following problems?**",
                        "label_parsed": "<strong>Questionnaire 1 : Over the last 2 weeks, how often have you been bothered by the following problems?<\/strong>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 2
                    },
                    {
                        "type": "mc_button",
                        "choice_list": "GAD_1",
                        "type_options": null,
                        "name": "GAD_1",
                        "label": "Feeling nervous, anxious or on edge",
                        "label_parsed": "Feeling nervous, anxious or on edge",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 3,
                        "choices": {
                            "1": "Not at all",
                            "2": "Several days",
                            "3": "More than half of the days",
                            "4": "Nearly every day"
                        }
                    },
                    {
                        "type": "mc_button",
                        "choice_list": "GAD_2",
                        "type_options": null,
                        "name": "GAD_2",
                        "label": "Not being able to stop or control worrying",
                        "label_parsed": "Not being able to stop or control worrying",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 4,
                        "choices": {
                            "1": "Not at all",
                            "2": "Several days",
                            "3": "More than half of the days",
                            "4": "Nearly every day"
                        }
                    },
                    {
                        "type": "mc_button",
                        "choice_list": "GAD_3",
                        "type_options": null,
                        "name": "GAD_3",
                        "label": "Worrying too much about different things",
                        "label_parsed": "Worrying too much about different things",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 5,
                        "choices": {
                            "1": "Not at all",
                            "2": "Several days",
                            "3": "More than half of the days",
                            "4": "Nearly every day"
                        }
                    },
                    {
                        "type": "mc_button",
                        "choice_list": "GAD_4",
                        "type_options": null,
                        "name": "GAD_4",
                        "label": "Trouble relaxing",
                        "label_parsed": "Trouble relaxing",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 6,
                        "choices": {
                            "1": "Not at all",
                            "2": "Several days",
                            "3": "More than half of the days",
                            "4": "Nearly every day"
                        }
                    },
                    {
                        "type": "mc_button",
                        "choice_list": "GAD_5",
                        "type_options": null,
                        "name": "GAD_5",
                        "label": "Being so restless that it is hard to sit still",
                        "label_parsed": "Being so restless that it is hard to sit still",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 7,
                        "choices": {
                            "1": "Not at all",
                            "2": "Several days",
                            "3": "More than half of the days",
                            "4": "Nearly every day"
                        }
                    },
                    {
                        "type": "mc_button",
                        "choice_list": "GAD_6",
                        "type_options": null,
                        "name": "GAD_6",
                        "label": "Becoming easily annoyed or irritable",
                        "label_parsed": "Becoming easily annoyed or irritable",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 8,
                        "choices": {
                            "1": "Not at all",
                            "2": "Several days",
                            "3": "More than half of the days",
                            "4": "Nearly every day"
                        }
                    },
                    {
                        "type": "mc_button",
                        "choice_list": "GAD_7",
                        "type_options": null,
                        "name": "GAD_7",
                        "label": "Feeling afraid as if something awful might happen",
                        "label_parsed": "Feeling afraid as if something awful might happen",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 9,
                        "choices": {
                            "1": "Not at all",
                            "2": "Several days",
                            "3": "More than half of the days",
                            "4": "Nearly every day"
                        }
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "QuestionBDI_II",
                        "label": "**Questionnaire 2 : This questionnaire consists of 21 groups of statements. Please read each group of statements carefully. And then pick out the one statement in each group that best describes the way you have been feeling during the past two weeks, including today. If several statements in the group seem to apply equally well, circle the highest number for that group.**",
                        "label_parsed": "<strong>Questionnaire 2 : This questionnaire consists of 21 groups of statements. Please read each group of statements carefully. And then pick out the one statement in each group that best describes the way you have been feeling during the past two weeks, including today. If several statements in the group seem to apply equally well, circle the highest number for that group.<\/strong>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 10
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_1",
                        "type_options": null,
                        "name": "BDI2_1",
                        "label": "Sadness",
                        "label_parsed": "Sadness",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 11,
                        "choices": {
                            "1": "I do not feel sad",
                            "2": "I feel sad much of the time.",
                            "3": "I am sad all the time",
                            "4": "I am so sad or unhappy that I can't stand it"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_2",
                        "type_options": null,
                        "name": "BDI2_2",
                        "label": "Pessimism",
                        "label_parsed": "Pessimism",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 12,
                        "choices": {
                            "1": "I am not discouraged about my future",
                            "2": "I feel more discouraged about my future than I used to",
                            "3": "I do not expect things to work out for me",
                            "4": "I feel my future is hopeless and will only get worse"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_3",
                        "type_options": null,
                        "name": "BDI2_3",
                        "label": "Past Failure",
                        "label_parsed": "Past Failure",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 13,
                        "choices": {
                            "1": "I do not feel like a failure",
                            "2": "I have failed more than I should have",
                            "3": "As I look back, I see a lot of failures",
                            "4": "I feel I am a total failure as a person"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_4",
                        "type_options": null,
                        "name": "BDI2_4",
                        "label": "Loss of Pleasure",
                        "label_parsed": "Loss of Pleasure",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 14,
                        "choices": {
                            "1": "I get as much pleasure as I ever did from the things I enjoy",
                            "2": "I don't enjoy things as much as I used to",
                            "3": "I get very little pleasure from the things I used to enjoy",
                            "4": "I can't get any pleasure from the things I used to enjoy"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_5",
                        "type_options": null,
                        "name": "BDI2_5",
                        "label": "Guilty Feelings",
                        "label_parsed": "Guilty Feelings",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 15,
                        "choices": {
                            "1": "I don't feel particularly guilty",
                            "2": "I feel guilty over many things I have done or should have done",
                            "3": "I feel quite guilty most of the time",
                            "4": "I feel guilty all of the time"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_6",
                        "type_options": null,
                        "name": "BDI2_6",
                        "label": "Punishment Feelings",
                        "label_parsed": "Punishment Feelings",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 16,
                        "choices": {
                            "1": "I don't feel I am being punished",
                            "2": "I feel I may be punished",
                            "3": "I expect to be punished",
                            "4": "I feel I am being punished"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_7",
                        "type_options": null,
                        "name": "BDI2_7",
                        "label": "Self-Dislike",
                        "label_parsed": "Self-Dislike",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 17,
                        "choices": {
                            "1": "I feel the same about myself as ever",
                            "2": "I have lost confidence in myself",
                            "3": "I am disappointed in myself",
                            "4": "I dislike myself"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_8",
                        "type_options": null,
                        "name": "BDI2_8",
                        "label": "Self-Criticalness",
                        "label_parsed": "Self-Criticalness",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 18,
                        "choices": {
                            "1": "I don't criticize or blame myself more than usual",
                            "2": "I am more critical of myself than I used to be",
                            "3": "I criticize myself for all of my faults",
                            "4": "I blame myself for everything bad that happens"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_9",
                        "type_options": null,
                        "name": "BDI2_9",
                        "label": "Suicidal Thoughts or Wishes",
                        "label_parsed": "Suicidal Thoughts or Wishes",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 19,
                        "choices": {
                            "1": "I don't have any thoughts of killing myself",
                            "2": "I have thoughts of killing myself, but I would not carry them out",
                            "3": "I would like to kill myself",
                            "4": "I would kill myself if I had the chance"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_10",
                        "type_options": null,
                        "name": "BDI2_10",
                        "label": "Crying",
                        "label_parsed": "Crying",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 20,
                        "choices": {
                            "1": "I don't cry anymore than I used to",
                            "2": "I cry more than I used to",
                            "3": "I cry over every little thing",
                            "4": "I feel like crying, but I can't"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_11",
                        "type_options": null,
                        "name": "BDI2_11",
                        "label": "Agitation",
                        "label_parsed": "Agitation",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 21,
                        "choices": {
                            "1": "I am no more restless or wound up than usual",
                            "2": "I feel more restless or wound up than usual",
                            "3": "I am so restless or agitated, it's hard to stay still",
                            "4": "I am so restless or agitated that I have to keep moving or doing something"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_12",
                        "type_options": null,
                        "name": "BDI2_12",
                        "label": "Loss of Interest",
                        "label_parsed": "Loss of Interest",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 22,
                        "choices": {
                            "1": "I have not lost interest in other people or activities",
                            "2": "I am less interested in other people or things than before",
                            "3": "I have lost most of my interest in other people or things",
                            "4": "It's hard to get interested in anything"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_13",
                        "type_options": null,
                        "name": "BDI2_13",
                        "label": "Indecisiveness",
                        "label_parsed": "Indecisiveness",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 23,
                        "choices": {
                            "1": "I make decisions about as well as ever",
                            "2": "I find it more difficult to make decisions than usual",
                            "3": "I have much greater difficulty in making decisions than I used to",
                            "4": "I have trouble making any decisions"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_14",
                        "type_options": null,
                        "name": "BDI2_14",
                        "label": "Worthlessness",
                        "label_parsed": "Worthlessness",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 24,
                        "choices": {
                            "1": "I do not feel I am worthless",
                            "2": "I don't consider myself as worthwhile and useful as I used to",
                            "3": "I feel more worthless as compared to others",
                            "4": "I feel utterly worthless"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_15",
                        "type_options": null,
                        "name": "BDI2_15",
                        "label": "Loss of Energy",
                        "label_parsed": "Loss of Energy",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 25,
                        "choices": {
                            "1": "I have as much energy as ever",
                            "2": "I have less energy than I used to have",
                            "3": "I don't have enough energy to do very much",
                            "4": "I don't have enough energy to do anything"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_16",
                        "type_options": null,
                        "name": "BDI2_16",
                        "label": "Changes in Sleeping Pattern",
                        "label_parsed": "Changes in Sleeping Pattern",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 26,
                        "choices": {
                            "1": "I have not experienced any change in my sleeping",
                            "2": "I sleep somewhat more than usual OR I sleep somewhat less than usual",
                            "3": "I sleep a lot more than usual OR I sleep a lot less than usual",
                            "4": "I sleep most of the day OR I wake up 1-2 hours early and can't get back to sleep"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_17",
                        "type_options": null,
                        "name": "BDI2_17",
                        "label": "Irritability",
                        "label_parsed": "Irritability",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 27,
                        "choices": {
                            "1": "I am not more irritable than usual",
                            "2": "I am more irritable than usual",
                            "3": "I am much more irritable than usual",
                            "4": "I am irritable all the time"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_18",
                        "type_options": null,
                        "name": "BDI2_18",
                        "label": "Changes in Appetite",
                        "label_parsed": "Changes in Appetite",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 28,
                        "choices": {
                            "1": "I have not experienced any change in my appetite",
                            "2": "My appetite is somewhat less than usual OR My appetite is somewhat greater than usual",
                            "3": "My appetite is much less than before OR My appetite is much greater than usual",
                            "4": "I have no appetite at all OR I crave food all the time"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_19",
                        "type_options": null,
                        "name": "BDI2_19",
                        "label": "Concentration Difficulty",
                        "label_parsed": "Concentration Difficulty",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 29,
                        "choices": {
                            "1": "I can concentrate as well as ever",
                            "2": "I can't concentrate as well as usua",
                            "3": "It's hard to keep my mind on anything for very long",
                            "4": "I find I can't concentrate on anything"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_20",
                        "type_options": null,
                        "name": "BDI2_20",
                        "label": "Tiredness or Fatigue",
                        "label_parsed": "Tiredness or Fatigue",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 30,
                        "choices": {
                            "1": "I am no more tired or fatigued than usual",
                            "2": "I get more tired or fatigued more easily than usual",
                            "3": "I am too tired or fatigued to do a lot of the things I used to do",
                            "4": "I am too tired or fatigued to do most of the things I used to do"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "BDI2_21",
                        "type_options": null,
                        "name": "BDI2_21",
                        "label": "Loss of Interest in Sex",
                        "label_parsed": "Loss of Interest in Sex",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 31,
                        "choices": {
                            "1": "I have not noticed any recent change in my interest in sex",
                            "2": "I am less interested in sex than I used to be",
                            "3": "I am much less interested in sex now",
                            "4": "I have lost interest in sex completely"
                        }
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "reread",
                        "label": "**Check that you have answered everything before submitting.**",
                        "label_parsed": "<strong>Check that you have answered everything before submitting.<\/strong>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 32
                    },
                    {
                        "type": "submit",
                        "choice_list": null,
                        "type_options": null,
                        "name": "submit1",
                        "label": "Proceed to the next step",
                        "label_parsed": "Proceed to the next step",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 33
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "QuestionSTAI_T",
                        "label": "**Questionnaire 3 : A number of statements which people have used to describe themselves are given below. Read each statement and then choose the appropriate answer to indicate how you generally feel. There are no right or wrong answers. Do not spend too much time on any one statement but give the answer which seems to describe how you generally feel.**",
                        "label_parsed": "<strong>Questionnaire 3 : A number of statements which people have used to describe themselves are given below. Read each statement and then choose the appropriate answer to indicate how you generally feel. There are no right or wrong answers. Do not spend too much time on any one statement but give the answer which seems to describe how you generally feel.<\/strong>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 34
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_1",
                        "type_options": null,
                        "name": "STAI_1",
                        "label": "I feel pleasant",
                        "label_parsed": "I feel pleasant",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 35,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_2",
                        "type_options": null,
                        "name": "STAI_2",
                        "label": "I feel nervous and restless",
                        "label_parsed": "I feel nervous and restless",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 36,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_3",
                        "type_options": null,
                        "name": "STAI_3",
                        "label": "I feel satisfied with myself",
                        "label_parsed": "I feel satisfied with myself",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 37,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_4",
                        "type_options": null,
                        "name": "STAI_4",
                        "label": "I wish I could be as happy as others seem to be",
                        "label_parsed": "I wish I could be as happy as others seem to be",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 38,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_5",
                        "type_options": null,
                        "name": "STAI_5",
                        "label": "I feel like a failure",
                        "label_parsed": "I feel like a failure",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 39,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_6",
                        "type_options": null,
                        "name": "STAI_6",
                        "label": "I feel rested",
                        "label_parsed": "I feel rested",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 40,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_7",
                        "type_options": null,
                        "name": "STAI_7",
                        "label": "I am \"calm, cool, and collected\"",
                        "label_parsed": "I am &quot;calm, cool, and collected&quot;",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 41,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_8",
                        "type_options": null,
                        "name": "STAI_8",
                        "label": "I feel that difficulties are piling up so that I cannot overcome them",
                        "label_parsed": "I feel that difficulties are piling up so that I cannot overcome them",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 42,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_9",
                        "type_options": null,
                        "name": "STAI_9",
                        "label": "I worry too much ovver something that really doesn't matter",
                        "label_parsed": "I worry too much ovver something that really doesn't matter",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 43,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_10",
                        "type_options": null,
                        "name": "STAI_10",
                        "label": "I am happy",
                        "label_parsed": "I am happy",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 44,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_11",
                        "type_options": null,
                        "name": "STAI_11",
                        "label": "I have disturbing thoughts",
                        "label_parsed": "I have disturbing thoughts",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 45,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_12",
                        "type_options": null,
                        "name": "STAI_12",
                        "label": "I lack self-confidence",
                        "label_parsed": "I lack self-confidence",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 46,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_13",
                        "type_options": null,
                        "name": "STAI_13",
                        "label": "I feel secure",
                        "label_parsed": "I feel secure",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 47,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_14",
                        "type_options": null,
                        "name": "STAI_14",
                        "label": "I make decisions easily",
                        "label_parsed": "I make decisions easily",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 48,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_15",
                        "type_options": null,
                        "name": "STAI_15",
                        "label": "I feel inadequate",
                        "label_parsed": "I feel inadequate",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 49,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_16",
                        "type_options": null,
                        "name": "STAI_16",
                        "label": "I am content",
                        "label_parsed": "I am content",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 50,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_17",
                        "type_options": null,
                        "name": "STAI_17",
                        "label": "Some unimportant thought runs through my mind and bothers me",
                        "label_parsed": "Some unimportant thought runs through my mind and bothers me",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 51,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_18",
                        "type_options": null,
                        "name": "STAI_18",
                        "label": "I take disappointments so keenly that I can't put them out of my mind",
                        "label_parsed": "I take disappointments so keenly that I can't put them out of my mind",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 52,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_19",
                        "type_options": null,
                        "name": "STAI_19",
                        "label": "I am a steady person",
                        "label_parsed": "I am a steady person",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 53,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "STAI_20",
                        "type_options": null,
                        "name": "STAI_20",
                        "label": "I get in a state of tension or turmoil as I think over my recent concerns and interests",
                        "label_parsed": "I get in a state of tension or turmoil as I think over my recent concerns and interests",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 54,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "reread2",
                        "label": "**Check that you have answered everything before submitting.**",
                        "label_parsed": "<strong>Check that you have answered everything before submitting.<\/strong>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 55
                    },
                    {
                        "type": "submit",
                        "choice_list": null,
                        "type_options": null,
                        "name": "submit2",
                        "label": "Proceed to the last questionnaire",
                        "label_parsed": "Proceed to the last questionnaire",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 56
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "QuestionRRS",
                        "label": "**Questionnaire 4 : People think and do many different things when they feel depressed. Please read each of the items below and indicate whether you almost never, sometimes, often, or almost always think or do each one when you feel down, sad, or depressed. Please indicate what you generally do, not what you think you should do.**",
                        "label_parsed": "<strong>Questionnaire 4 : People think and do many different things when they feel depressed. Please read each of the items below and indicate whether you almost never, sometimes, often, or almost always think or do each one when you feel down, sad, or depressed. Please indicate what you generally do, not what you think you should do.<\/strong>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 57
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_1",
                        "type_options": null,
                        "name": "RRS_1",
                        "label": "Think about how alone you feel",
                        "label_parsed": "Think about how alone you feel",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 58,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_2",
                        "type_options": null,
                        "name": "RRS_2",
                        "label": "Think \"I won't be able to do my job if I don't snap out of this\"",
                        "label_parsed": "Think &quot;I won't be able to do my job if I don't snap out of this&quot;",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 59,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_3",
                        "type_options": null,
                        "name": "RRS_3",
                        "label": "Think about how hard it is to concentrate",
                        "label_parsed": "Think about how hard it is to concentrate",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 60,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_4",
                        "type_options": null,
                        "name": "RRS_4",
                        "label": "Think about your feelings of fatigue and achiness",
                        "label_parsed": "Think about your feelings of fatigue and achiness",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 61,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_5",
                        "type_options": null,
                        "name": "RRS_5",
                        "label": "Think \"What am I doing to deserve this?\"",
                        "label_parsed": "Think &quot;What am I doing to deserve this?&quot;",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 62,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_6",
                        "type_options": null,
                        "name": "RRS_6",
                        "label": "Think about how passive and unmotivated you feel",
                        "label_parsed": "Think about how passive and unmotivated you feel",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 63,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_7",
                        "type_options": null,
                        "name": "RRS_7",
                        "label": "Analyze recent events to try to understand why you are depressed",
                        "label_parsed": "Analyze recent events to try to understand why you are depressed",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 64,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_8",
                        "type_options": null,
                        "name": "RRS_8",
                        "label": "Think about how you don't seem to feel anything anymore",
                        "label_parsed": "Think about how you don't seem to feel anything anymore",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 65,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_9",
                        "type_options": null,
                        "name": "RRS_9",
                        "label": "Think \"Why can't I get going?\"",
                        "label_parsed": "Think &quot;Why can't I get going?&quot;",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 66,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_10",
                        "type_options": null,
                        "name": "RRS_10",
                        "label": "Think \"Why do I always react this way?\"",
                        "label_parsed": "Think &quot;Why do I always react this way?&quot;",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 67,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_11",
                        "type_options": null,
                        "name": "RRS_11",
                        "label": "Go away by yourself and think about why you feel this way",
                        "label_parsed": "Go away by yourself and think about why you feel this way",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 68,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_12",
                        "type_options": null,
                        "name": "RRS_12",
                        "label": "Write down what you are thinking about and analyze it",
                        "label_parsed": "Write down what you are thinking about and analyze it",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 69,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_13",
                        "type_options": null,
                        "name": "RRS_13",
                        "label": "Think about a recent situation, wishing it had gone better",
                        "label_parsed": "Think about a recent situation, wishing it had gone better",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 70,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_14",
                        "type_options": null,
                        "name": "RRS_14",
                        "label": "Think \"I won't be able to concentrate if I keep feeling this way\"",
                        "label_parsed": "Think &quot;I won't be able to concentrate if I keep feeling this way&quot;",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 71,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_15",
                        "type_options": null,
                        "name": "RRS_15",
                        "label": "Think \"Why do I have problems that other people don't have?\"",
                        "label_parsed": "Think &quot;Why do I have problems that other people don't have?&quot;",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 72,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_16",
                        "type_options": null,
                        "name": "RRS_16",
                        "label": "Think \"Why can't I handle things better?\"",
                        "label_parsed": "Think &quot;Why can't I handle things better?&quot;",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 73,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_17",
                        "type_options": null,
                        "name": "RRS_17",
                        "label": "Think about how sad you feel",
                        "label_parsed": "Think about how sad you feel",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 74,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_18",
                        "type_options": null,
                        "name": "RRS_18",
                        "label": "Think about all your shortcomings, failings, faults, mistakes",
                        "label_parsed": "Think about all your shortcomings, failings, faults, mistakes",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 75,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_19",
                        "type_options": null,
                        "name": "RRS_19",
                        "label": "Think about how you don't feel up to doing anything",
                        "label_parsed": "Think about how you don't feel up to doing anything",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 76,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_20",
                        "type_options": null,
                        "name": "RRS_20",
                        "label": "Analyze your personality to try to understand why you are depressed",
                        "label_parsed": "Analyze your personality to try to understand why you are depressed",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 77,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_21",
                        "type_options": null,
                        "name": "RRS_21",
                        "label": "Go someplace alone to think about your feelings",
                        "label_parsed": "Go someplace alone to think about your feelings",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 78,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "mc",
                        "choice_list": "RRS_22",
                        "type_options": null,
                        "name": "RRS_22",
                        "label": "Think about how angry you are with yourself",
                        "label_parsed": "Think about how angry you are with yourself",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 79,
                        "choices": {
                            "1": "Almost never",
                            "2": "Sometimes",
                            "3": "Often",
                            "4": "Almost always"
                        }
                    },
                    {
                        "type": "note",
                        "choice_list": null,
                        "type_options": null,
                        "name": "reread3",
                        "label": "**Check that you have answered everything before submitting.**",
                        "label_parsed": "<strong>Check that you have answered everything before submitting.<\/strong>",
                        "optional": 1,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 80
                    },
                    {
                        "type": "submit",
                        "choice_list": null,
                        "type_options": null,
                        "name": "submit3",
                        "label": "Submit",
                        "label_parsed": "Submit",
                        "optional": 0,
                        "class": "",
                        "showif": "",
                        "value": "",
                        "block_order": null,
                        "item_order": 81
                    }
                ],
                "settings": {
                    "maximum_number_displayed": 0,
                    "displayed_percentage_maximum": 100,
                    "add_percentage_points": 0,
                    "enable_instant_validation": 1,
                    "expire_after": 0,
                    "google_file_id": "1BO8-cnwEjTEfMKbo3W7RHMak8uACZFm1JBWNxTb9U2A",
                    "unlinked": 0,
                    "expire_invitation_after": 0,
                    "expire_invitation_grace": 0,
                    "hide_results": 0,
                    "use_paging": 0
                }
            }
        },
        {
            "type": "Endpage",
            "description": "END -  FINI",
            "position": 300,
            "special": "",
            "body": "## The study is now complete!\r\n\r\n```{r, include=FALSE, warning = FALSE, message=FALSE, echo=FALSE}\r\n\r\nlibrary(dplyr)\r\nlibrary(lubridate)\r\n\r\n# ===================================\r\n# ====== define all variables =======\r\n# ===================================\r\n\r\ndays_duration_study = 14\r\nsurveys_by_day      = 4\r\ntimezone            = \"CET\"\r\nto_day              = today(timezone)\r\nnow_date            = now(timezone)\r\nt_zero              = \"00:05\"\r\nlast_timepoint      = \"23:30\"\r\ntimepoints          = c(\"09:00\", \"13:00\",\"17:00\",\"21:00\")  # write just the hours\r\nESM_questionnaire   = EF_RUM_ESM_v2_EN\r\n\r\n# ===================================\r\n# ===================================\r\n\r\n\r\n\r\n\r\ndays_done = 0\r\n\r\nmax_surveys = surveys_by_day * days_duration_study\r\n\r\n# lets check how many questionnaires they filled\r\n\r\ndate_start = as.Date(enrolling_surveyEN$created)\r\n\r\nlast_day_study = as.Date(enrolling_surveyEN$created)+ days(days_duration_study)\r\n\r\n# get the numbers of day left\r\ndays_left = last_day_study - today()\r\n# difftime(df$datevar1 ,df$datevar2 , units = c(\"days\"))\r\n\r\ndays_done = days_duration_study - days_left\r\n\r\n# let's create a progress visual\r\n\r\nprogress = \"\"\r\nfor(i in 1:days_duration_study) {\r\n  if(i <= days_done) {\r\n  progress = paste0(progress, \"\\n### <span style='color:green'>**Day** **\",i,\"**<\/span> ![](https:\/\/i.imgur.com\/nUY7Ifu.png){width=50px}\\n\")\r\n  } else if (i > days_done) {\r\n  progress = paste0(progress, \"\\n### <span style='color:darkgray'>**Day** **\",i,\"**<\/span> ![](https:\/\/i.imgur.com\/xuosH6S.png){width=50px}\\n\")\r\n  }\r\n  \r\n}\r\n\r\n```\r\n\r\nThank you so much for participating in this study and for completing the first part of it. It is because of you and the other participants that this research can take place.\r\n\r\nNow that you have finished the first part of the study, Yorgo Hoebeke will contact you again to set up the two appointments for the second part of the study via a doodle.\r\n\r\n***\r\n\r\n### Your progress :\r\n`r progress`\r\n\r\n***"
        },
        {
            "type": "Endpage",
            "description": "EXCLU - mail pas confirmé",
            "position": 310,
            "special": "",
            "body": "You did not confirm your email address or mobile phone number in time.\r\n\r\nIf you still want to participate in the study, please click on this link first: http:\/\/formr.org\/logout."
        },
        {
            "type": "SkipBackward",
            "description": "",
            "position": 320,
            "special": "",
            "condition": "",
            "if_true": 0
        }
    ],
    "settings": {
        "header_image_path": "",
        "description": "",
        "footer_text": "Contact the [study manager](mailto:<enter your email>) if you have questions.",
        "public_blurb": "",
        "cron_active": 1,
        "custom_js": "document.getElementById(\"item0\").remove();\n\nlet node = document.getElementById(\"item0\");\nif (node.parentNode) {\n  node.parentNode.removeChild(node);\n}",
        "custom_css": "body, td { \nfont:normal normal 150%\/1.2 verdana, arial; \n}\n\n#item0 {\n    display:none;\n}\n\nform.form-horizontal div.form-row div.controls div.mc-table label{\n\tfloat:left;\n\tdisplay:inline-block !important;\n\tmax-width:100%;\n\twidth:100%;\n}\n\n.run-container a.btn.btn-checked, .run-container button.btn.btn-checked, .run-container label.btn.btn-checked {\n    background-color: #337ab7!important;\n    color: white;\n    font-weight: bold;\n    z-index: 2;\n    border: 1px solid #000;\n    outline: 1px;\n    -webkit-box-shadow: inset 0 2px 4px rgba(0,0,0,.15), 0 1px 2px rgba(0,0,0,.05);\n    box-shadow: inset 0 2px 4px rgba(0,0,0,.15), 0 1px 2px rgba(0,0,0,.05);\n}\n\n.progress-container{\n    display:none;\n}\n\n.run-container .run_content{\n\tfont-size:1.1em;\n\tline-height:1.4em;\n}\n\n\n\n\/* this is for the multiple choices at the end questionnaires *\/\n.form-horizontal .item-mc .control-label{\n    padding-top: 5px;\n    margin-bottom: 10px;\n    font-weight:600;\n    color:#0f72c7;\n}\n\n.form-horizontal .item-mc_button .control-label{\n    padding-top: 5px;\n    margin-bottom: 10px;\n    font-weight:600;\n    color:#0f72c7;\n}\n\nform.form-horizontal div.form-row div.controls div.mc-table label {\n    display: inline-block;\n    padding-right: 5px;\n    padding-top: 5px;\n    width: 100%;\n}\n\n.study-name-EF_RUM_ESM_v2 .item-range .control-label::before {\n  content: \"\";\n}\n\nform.form-horizontal div.form-row div.controls label.keep-label {\n    margin-right: 5px;\n    font-size: 0.8em !important;\n}\n\nform.form-horizontal div.form-row div.controls label {\n    font-size: 1em;\n}\n\n.run-container .form-group .control-label, .run-container .form-group label {\n    font-size: 1em;\n}\n\n.form-group .ws-range {\n    width: 50%;\n    margin-top: 10px;\n}\n\n.item-email .controls-inner {\n    display: block;\n    margin-top: -10px;\n}\n\n.item-tel .controls-inner {\n    display: block;\n    margin-top: -10px;\n}\n\n.ws-range .ws-range-progress {\n    background: #1383e2;\n}\n\n.ws-range .ws-range-thumb {\n    position: absolute;\n    display: block;\n    z-index: 4;\n    margin: -.38462em 0 0 -1.15385em;\n    height: 1.5em;\n    width: 1.5em;\n    background: #ccc;\n    border: .07692em solid darkblue;\n    cursor: pointer;\n    border-radius: 1.5em;\n    transition: background-color 400ms,border-color 400ms;\n}\n\n\/* Positionnement des labels en dessous du slider *\/\n\n.form-horizontal .item-range .controls, .form-horizontal .item-range_ticks .controls {\n    margin-left:20%;\n    margin-right:20%;\n    margin-top:20px;\n}\n\n\n.form-horizontal .item-range .control-label, .form-horizontal .item-range_ticks .control-label {\n    float: none;\n    width: 100%;\n    padding-top: 5px;\n    text-align: left;\n    white-space: normal;\n    margin-top:30px;\n    margin-bottom: 20px;\n    font-weight:600;\n    color:#0f72c7;\n}\n\n\ndiv.controls-inner {\n    position:relative!important;\n}\n    \nlabel.pad-left {\n    position: absolute!important;\n    top:25px;\n    right:0px;\n    text-align:right;\n}\n    \nlabel.pad-right {\n    position: absolute!important;\n    top:25px;\n    text-align:left;\n}\n    \n.form-group .ws-range {\n    margin-left:25%;\n    margin-right:25%;\n}\n\n\/*\n.form-group .ws-range-min.ws-range-progress {\n    color:#0f72c7;\n} *\/\n\n\/*\n.ws-range-thumb>span, .ws-range-thumb>span>span:before {\n    display: block;\n    content: attr(data-value)!important;\n    visibility: visible!important;\n}*\/\n\n.ws-range:before {\n    position: absolute;\n    left: 50%;\n    top: -34px;\n    width: 40px;\n    margin-left: -20px;\n    display: inline-block;\n    text-align: center;\n    content: attr(aria-valuenow)!important;\n    visibility: visible!important;\n    border: .07692em solid #ccc;\n}\n\n.ws-range .ws-range-thumb>span {\n    position: absolute;\n    margin: 0 0 3px -15px;\n    padding: 0;\n    border: 0;\n    left: 50%;\n    bottom: 1.46154em;\n    visibility: hidden;\n    width: 30px;\n    text-align: center;\n    background: 0;\n}\n\n.fmr-survey-page-count {\n    margin-top:40px;\n}\n\n\/* Tooltip container *\/\n.tooltip {\n  position: relative;\n  display: inline-block;\n  border-bottom: 1px dotted black; \/* If you want dots under the hoverable text *\/\n  font-size: 1em;\n  font-weight:600;\n}\n\n\/* Tooltip text *\/\n.tooltip .tooltiptext {\n    white-space: pre-line;\n  visibility: hidden;\n  background-color: black;\n  color: #fff;\n  text-align: left;\n    font-weight:500;\n  \/* Position the tooltip text - see examples below! *\/\n  width:100%;\n  max-width:500px;\n\n    border: solid;\n    border-color:  white;\n    border-width: 1px;\n    border-radius:6px;\n    padding:10px;\n    bottom: -50px;\n    left: 50%;\n    -webkit-transform: translateX(-50%);\n    -moz-transform: translateX(-50%);\n    -ms-transform: translateX(-50%);\n    -o-transform: translateX(-50%);\n    transform: translateX(-50%);\n    position: absolute;\n}\n\n\/* Show the tooltip text when you mouse over the tooltip container *\/\n.tooltip:hover .tooltiptext {\n  visibility: visible;\n}\n\n.tooltip:hover {\n      cursor:pointer;\n}"
    },
    "files": []
}